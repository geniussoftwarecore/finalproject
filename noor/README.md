# نظام إدارة المستخدمين

## نظرة عامة

نظام إدارة المستخدمين هو مشروع ويب كامل مبني باستخدام PHP و PDO مع قاعدة بيانات MySQL. يوفر النظام إمكانية إنشاء حسابات المستخدمين، تسجيل الدخول، إدارة المستخدمين، وحماية متقدمة.

## المميزات

- ✅ إنشاء حسابات جديدة مع التحقق من صحة البيانات
- ✅ تسجيل الدخول مع وظيفة "تذكرني"
- ✅ لوحة تحكم للمستخدمين
- ✅ لوحة إدارة للمديرين
- ✅ حماية متقدمة مع CSRF و reCAPTCHA
- ✅ تشفير كلمات المرور
- ✅ تصميم متجاوب وحديث
- ✅ دعم اللغة العربية بالكامل
- ✅ نظام خاص (Private) بدون APIs خارجية
- ✅ التحقق المحلي للبيانات

## متطلبات النظام

- PHP 7.4 أو أحدث
- MySQL 5.7 أو أحدث
- Apache/Nginx
- إمكانية الوصول إلى الإنترنت (لـ reCAPTCHA)

## التثبيت المحلي

### الخطوة 1: إعداد البيئة المحلية

1. **تثبيت XAMPP أو WAMP:**
   - قم بتحميل وتثبيت XAMPP من [الموقع الرسمي](https://www.apachefriends.org/)
   - أو WAMP من [الموقع الرسمي](https://www.wampserver.com/)

2. **تشغيل الخدمات:**
   - شغل Apache و MySQL من لوحة التحكم

### الخطوة 2: إعداد قاعدة البيانات

1. **فتح phpMyAdmin:**
   - اذهب إلى `http://localhost/phpmyadmin`

2. **إنشاء قاعدة البيانات:**
   ```sql
   CREATE DATABASE project_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

3. **استيراد ملف قاعدة البيانات:**
   - انقر على "استيراد" (Import)
   - اختر ملف `db.sql`
   - انقر على "تنفيذ" (Go)

### الخطوة 3: رفع الملفات

1. **نسخ الملفات:**
   - انسخ جميع ملفات المشروع إلى مجلد `htdocs` في XAMPP
   - أو `www` في WAMP

2. **هيكل المجلدات:**
   ```
   htdocs/
   ├── app/
   │   ├── config/
   │   ├── lib/
   │   └── models/
   ├── public/
   │   └── assets/
   ├── admin/
   ├── api/
   └── auth/
   ```

### الخطوة 4: إعداد reCAPTCHA

1. **الحصول على مفاتيح reCAPTCHA:**
   - اذهب إلى [Google reCAPTCHA](https://www.google.com/recaptcha/)
   - سجل دخول بحساب Google
   - انقر على "+" لإنشاء موقع جديد
   - اختر reCAPTCHA v2
   - أضف `localhost` في قائمة النطاقات
   - انسخ المفتاح العام والمفتاح السري

2. **تحديث ملف التكوين:**
   - افتح `app/config/config.php`
   - استبدل `YOUR_RECAPTCHA_SITE_KEY` بالمفتاح العام
   - استبدل `YOUR_RECAPTCHA_SECRET_KEY` بالمفتاح السري

### الخطوة 5: اختبار النظام

1. **فتح الموقع:**
   - اذهب إلى `http://localhost/project/public/`

2. **إنشاء حساب جديد:**
   - استخدم إيميل من gmail.com أو hotmail.com
   - كلمة مرور قوية (8 أحرف على الأقل مع حروف وأرقام ورموز)

3. **تسجيل الدخول:**
   - استخدم الحساب الذي أنشأته
   - أو استخدم الحساب الافتراضي:
     - اسم المستخدم: `admin`
     - كلمة المرور: `password`

## التثبيت على الاستضافة

### الخطوة 1: إعداد قاعدة البيانات

1. **إنشاء قاعدة البيانات:**
   - اذهب إلى cPanel
   - انقر على "قواعد البيانات MySQL"
   - أنشئ قاعدة بيانات جديدة باسم `project_db`
   - أنشئ مستخدم جديد واربطه بقاعدة البيانات

2. **استيراد البيانات:**
   - اذهب إلى phpMyAdmin
   - اختر قاعدة البيانات الجديدة
   - انقر على "استيراد"
   - ارفع ملف `db.sql`

### الخطوة 2: رفع الملفات

1. **رفع الملفات:**
   - استخدم FTP أو File Manager
   - ارفع جميع ملفات المشروع إلى المجلد العام (public_html)

2. **تحديث مسارات الملفات:**
   - تأكد من أن جميع المسارات صحيحة
   - قد تحتاج لتعديل مسارات CSS و JavaScript

### الخطوة 3: تحديث إعدادات قاعدة البيانات

1. **تحديث ملف التكوين:**
   - افتح `app/config/config.php`
   - غيّر إعدادات قاعدة البيانات:
   ```php
   define('DB_HOST', 'localhost');
   define('DB_NAME', 'your_database_name');
   define('DB_USER', 'your_username');
   define('DB_PASS', 'your_password');
   ```

### الخطوة 4: إعداد reCAPTCHA للاستضافة

1. **تحديث مفاتيح reCAPTCHA:**
   - أضف نطاق الاستضافة في إعدادات reCAPTCHA
   - حدث المفاتيح في ملف التكوين

## هيكل المشروع

```
project/
├── app/                    # منطق التطبيق
│   ├── config/            # ملفات التكوين
│   │   └── config.php     # التكوين الرئيسي
│   ├── lib/               # المكتبات
│   │   ├── auth.php       # مكتبة المصادقة
│   │   ├── captcha.php    # مكتبة reCAPTCHA
│   │   └── validation.php # مكتبة التحقق
│   └── models/            # نماذج البيانات
│       └── UserModel.php  # نموذج المستخدم
├── public/                # الملفات العامة
│   ├── assets/            # الأصول (CSS, JS)
│   │   ├── css/
│   │   │   └── style.css  # ملف التنسيق الرئيسي
│   │   └── js/
│   │       └── main.js    # ملف JavaScript الرئيسي
│   ├── index.php          # الصفحة الرئيسية
│   ├── login.php          # تسجيل الدخول
│   ├── dashboard.php      # لوحة التحكم
│   ├── profile.php        # الملف الشخصي
│   └── logout.php         # تسجيل الخروج
├── admin/                  # لوحة الإدارة
│   └── admin.php          # صفحة الإدارة
├── auth/                  # المصادقة (ملفات محلية فقط)
├── db.sql                 # ملف قاعدة البيانات
├── README.md              # دليل المشروع
└── checklist.md           # قائمة التحقق
```

## الأمان

### الحماية المطبقة

1. **تشفير كلمات المرور:**
   - استخدام `password_hash()` و `password_verify()`
   - تشفير قوي باستخدام bcrypt

2. **حماية CSRF:**
   - رموز CSRF في جميع النماذج
   - التحقق من صحة الرموز

3. **reCAPTCHA:**
   - حماية من البوتات والهجمات التلقائية
   - التحقق من صحة الاستجابة

4. **تنظيف المدخلات:**
   - `htmlspecialchars()` لجميع المخرجات
   - `sanitizeInput()` للتنظيف

5. **حماية قاعدة البيانات:**
   - استخدام PDO مع Prepared Statements
   - منع SQL Injection

### إعدادات الأمان الإضافية

1. **تحديث كلمة مرور المدير:**
   ```sql
   UPDATE users SET password_hash = '$2y$10$...' WHERE username = 'admin';
   ```

2. **تغيير إعدادات reCAPTCHA:**
   - استخدم مفاتيح جديدة للاستضافة
   - فعّل إعدادات الأمان المتقدمة

## استكشاف الأخطاء

### المشاكل الشائعة

1. **خطأ في الاتصال بقاعدة البيانات:**
   - تحقق من إعدادات قاعدة البيانات
   - تأكد من تشغيل MySQL
   - تحقق من صحة اسم المستخدم وكلمة المرور

2. **خطأ في reCAPTCHA:**
   - تحقق من صحة المفاتيح
   - تأكد من إضافة النطاق الصحيح
   - تحقق من اتصال الإنترنت

3. **مشاكل في الصلاحيات:**
   - تحقق من صلاحيات الملفات (755 للمجلدات، 644 للملفات)
   - تأكد من صلاحيات الكتابة في مجلدات التخزين

4. **مشاكل في التصميم:**
   - تحقق من مسارات CSS و JavaScript
   - تأكد من تحميل Font Awesome
   - تحقق من إعدادات الخادم

### سجلات الأخطاء

- تحقق من سجلات Apache: `/var/log/apache2/error.log`
- تحقق من سجلات PHP: `php.ini` → `log_errors = On`
- استخدم `error_log()` في الكود للتتبع

## التطوير والتخصيص

### إضافة ميزات جديدة

1. **إضافة حقول جديدة:**
   - عدّل جدول `users` في قاعدة البيانات
   - حدث `UserModel.php`
   - أضف الحقول في النماذج

2. **إضافة صفحات جديدة:**
   - أنشئ ملف PHP جديد
   - أضف `require_once` للمكتبات المطلوبة
   - استخدم `requireLogin()` أو `requireAdmin()`

3. **تخصيص التصميم:**
   - عدّل `public/assets/css/style.css`
   - أضف أنماط جديدة
   - استخدم متغيرات CSS للتخصيص

### أفضل الممارسات

1. **الأمان:**
   - استخدم Prepared Statements دائماً
   - تحقق من صحة جميع المدخلات
   - استخدم HTTPS في الإنتاج

2. **الأداء:**
   - استخدم فهرسة قاعدة البيانات
   - قلل من استعلامات قاعدة البيانات
   - استخدم التخزين المؤقت عند الحاجة

3. **الصيانة:**
   - اكتب تعليقات واضحة
   - استخدم أسماء متغيرات وصفية
   - نظم الكود في ملفات منفصلة

## الدعم والمساعدة

### الموارد المفيدة

- [وثائق PHP الرسمية](https://www.php.net/docs.php)
- [وثائق PDO](https://www.php.net/manual/en/book.pdo.php)
- [وثائق reCAPTCHA](https://developers.google.com/recaptcha)
- [أفضل ممارسات الأمان](https://owasp.org/www-project-top-ten/)

### التواصل

إذا واجهت أي مشاكل أو لديك اقتراحات، يرجى:

1. تحقق من قائمة التحقق في `checklist.md`
2. راجع سجلات الأخطاء
3. تأكد من اتباع خطوات التثبيت بدقة

## الترخيص

هذا المشروع مفتوح المصدر ومتاح للاستخدام التعليمي والتجاري.

---

**ملاحظة:** تأكد من تحديث كلمة مرور المدير الافتراضية فور التثبيت لأسباب أمنية.
